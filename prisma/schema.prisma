generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-1.0.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

/// The main business process register model
model BusinessProcessRegister {
  id                Int            @id @default(autoincrement())
  business_area     String?        @db.VarChar(50)
  sub_business_area String?        @db.VarChar(100)
  process_name      String?        @db.VarChar(100)
  document_name     String?        @db.VarChar(100)
  version           String?        @db.VarChar(20)
  progress          String?        @db.VarChar(20)
  doc_status        String?        @db.VarChar(20)
  status_percentage Decimal?       @db.Decimal(5, 0)
  priority          String?        @db.VarChar(20)
  target_date       DateTime?      @db.Date
  process_owner     String?        @db.VarChar(20)
  update_date       DateTime?      @db.Date
  remarks           String?        @db.Text
  review_date       DateTime?      @db.Date
  file_url          String?        @db.VarChar(500)
  file_name         String?        @db.VarChar(255)
  file_size         BigInt?
  file_type         String?        @db.VarChar(100)
  uploaded_at       DateTime?      @default(now()) @db.Timestamp(0)
  deleted_at        DateTime?      @db.Timestamp(0)
  deleted_by        Int?
  businessareas     BusinessAreas? @relation(fields: [business_area], references: [business_area], onDelete: NoAction, onUpdate: NoAction, map: "fk_bpr_business_area")
  deletedBy         User?          @relation("BusinessProcessDeletedBy", fields: [deleted_by], references: [id])
  linkedDocuments   BusinessProcessDocumentLink[]
  fileVersions      BusinessProcessFileVersion[]

  @@index([business_area], map: "fk_bpr_business_area")
  @@index([deleted_at], map: "idx_deleted_at")
  @@index([deleted_by], map: "idx_deleted_by")
  @@map("businessprocessregister")
}

/// The business quality objectives model
model BusinessQualityObjective {
  id                        Int            @id @default(autoincrement())
  category                  String?        @db.VarChar(100)
  business_area             String?        @db.VarChar(50)
  sub_business_area         String?        @db.VarChar(100)
  qms_main_objectives       String?        @db.Text
  qms_objective_description String?        @db.Text
  kpi_or_sla_targets        String?        @db.Text
  performance_monitoring    String?        @db.Text
  proof_of_measuring        String?        @db.VarChar(20)
  proof_of_reporting        String?        @db.VarChar(20)
  frequency                 String?        @db.VarChar(20)
  responsible_person_team   String?        @db.VarChar(100)
  review_date               DateTime?      @db.Date
  progress                  String?        @db.VarChar(20)
  status_percentage         Int?
  doc_status                String?        @db.VarChar(20)
  version                   String?        @db.VarChar(20)
  file_url                  String?        @db.VarChar(500)
  file_name                 String?        @db.VarChar(255)
  file_size                 BigInt?
  file_type                 String?        @db.VarChar(100)
  uploaded_at               DateTime?      @default(now()) @db.Timestamp(0)
  deleted_at                DateTime?      @db.Timestamp(0)
  deleted_by                Int?
  businessareas             BusinessAreas? @relation(fields: [business_area], references: [business_area], onDelete: NoAction, onUpdate: NoAction, map: "fk_bqo_business_area")
  deletedBy                 User?          @relation("BusinessQualityObjectiveDeletedBy", fields: [deleted_by], references: [id])
  monthlyProgress           BusinessQualityObjectiveProgress[]
  fileVersions              BusinessQualityObjectiveFileVersion[]

  @@index([business_area], map: "fk_bqo_business_area")
  @@index([deleted_at], map: "idx_deleted_at")
  @@index([deleted_by], map: "idx_deleted_by")
  @@map("businessqualityobjectives")
}

/// Business Quality Objective Monthly Progress Tracking
model BusinessQualityObjectiveProgress {
  id           Int      @id @default(autoincrement())
  objective_id Int
  month        Int      @db.TinyInt // 1-12
  year         Int
  percentage   Decimal  @db.Decimal(5, 2) // 0.00-100.00
  notes        String?  @db.Text
  created_at   DateTime @default(now()) @db.Timestamp(0)
  updated_at   DateTime @default(now()) @updatedAt @db.Timestamp(0)
  created_by   Int?
  
  objective    BusinessQualityObjective @relation(fields: [objective_id], references: [id], onDelete: Cascade)
  createdBy    User?                    @relation("BusinessQualityObjectiveProgressCreatedBy", fields: [created_by], references: [id])

  @@unique([objective_id, month, year], map: "unique_objective_month_year")
  @@index([objective_id], map: "idx_objective_id")
  @@index([month, year], map: "idx_month_year")
  @@index([created_by], map: "idx_created_by")
  @@index([created_at], map: "idx_created_at")
  @@map("business_quality_objective_progress")
}

model TrainingSession {
  id            Int            @id @default(autoincrement())
  business_area String?        @db.VarChar(50)
  sessions      String         @db.VarChar(50)
  session_date  DateTime       @db.Date
  remarks       String         @db.Text
  version       String?        @db.VarChar(20)
  file_url      String?        @db.VarChar(500)
  file_name     String?        @db.VarChar(255)
  file_size     BigInt?
  file_type     String?        @db.VarChar(100)
  uploaded_at   DateTime?      @default(now()) @db.Timestamp(0)
  deleted_at    DateTime?      @db.Timestamp(0)
  deleted_by    Int?
  businessareas BusinessAreas? @relation(fields: [business_area], references: [business_area], onDelete: NoAction, onUpdate: NoAction, map: "fk_ts_business_area")
  deletedBy     User?          @relation("TrainingSessionDeletedBy", fields: [deleted_by], references: [id])
  fileVersions  TrainingSessionFileVersion[]

  @@index([business_area], map: "fk_ts_business_area")
  @@index([deleted_at], map: "idx_deleted_at")
  @@index([deleted_by], map: "idx_deleted_by")
  @@map("trainingsessions")
}

model BusinessDocumentRegister {
  id                 Int            @id @default(autoincrement())
  business_area      String?        @db.VarChar(50)
  sub_business_area  String?        @db.VarChar(100)
  document_name      String?        @db.VarChar(100)
  name_and_numbering String?        @db.VarChar(100)
  document_type      String?        @db.VarChar(20)
  version            String?        @db.VarChar(20)
  progress           String?        @db.VarChar(20)
  doc_status         String?        @db.VarChar(20)
  status_percentage  Decimal?       @db.Decimal(5, 0)
  priority           String?        @db.VarChar(20)
  target_date        DateTime?      @db.Date
  document_owner     String?        @db.VarChar(20)
  update_date        DateTime?      @db.Date
  remarks            String?        @db.Text
  review_date        DateTime?      @db.Date
  file_url           String?        @db.VarChar(500)
  file_name          String?        @db.VarChar(255)
  file_size          BigInt?
  file_type          String?        @db.VarChar(100)
  uploaded_at        DateTime?      @default(now()) @db.Timestamp(0)
  deleted_at         DateTime?      @db.Timestamp(0)
  deleted_by         Int?
  businessareas      BusinessAreas? @relation(fields: [business_area], references: [business_area], onDelete: NoAction, onUpdate: NoAction, map: "fk_bdr_business_area")
  deletedBy          User?          @relation("BusinessDocumentDeletedBy", fields: [deleted_by], references: [id])
  linkedProcesses    BusinessProcessDocumentLink[]
  // Document-to-document links
  relatedDocumentsPrimary BusinessDocumentLink[] @relation("PrimaryDocument")
  relatedDocumentsRelated BusinessDocumentLink[] @relation("RelatedDocument")
  fileVersions       BusinessDocumentFileVersion[]

  @@index([business_area], map: "fk_bdr_business_area")
  @@index([deleted_at], map: "idx_deleted_at")
  @@index([deleted_by], map: "idx_deleted_by")
  @@map("businessdocumentregister")
}

/// Business Process Document Links - Junction table linking Business Processes to Business Documents
model BusinessProcessDocumentLink {
  id                    Int      @id @default(autoincrement())
  business_process_id   Int
  business_document_id  Int
  process_version       String?  @db.VarChar(20)
  created_at            DateTime @default(now()) @db.Timestamp(0)
  updated_at            DateTime @default(now()) @updatedAt @db.Timestamp(0)
  created_by            Int?
  
  businessProcess       BusinessProcessRegister @relation(fields: [business_process_id], references: [id], onDelete: Cascade)
  businessDocument      BusinessDocumentRegister @relation(fields: [business_document_id], references: [id], onDelete: Cascade)
  createdBy             User? @relation("BusinessProcessDocumentLinkCreatedBy", fields: [created_by], references: [id])
  
  @@unique([business_process_id, business_document_id], map: "unique_bp_bd_link")
  @@index([business_process_id], map: "idx_business_process_id")
  @@index([business_document_id], map: "idx_business_document_id")
  @@index([process_version], map: "idx_process_version")
  @@index([created_by], map: "idx_created_by")
  @@index([created_at], map: "idx_created_at")
  @@map("business_process_document_links")
}

/// Business Process File Versions - Stores historical file uploads for each version
model BusinessProcessFileVersion {
  id                Int      @id @default(autoincrement())
  business_process_id Int
  process_version   String   @db.VarChar(20)
  file_url          String   @db.VarChar(500)
  file_name         String   @db.VarChar(255)
  file_size         BigInt?
  file_type         String?  @db.VarChar(100)
  uploaded_at       DateTime @default(now()) @db.Timestamp(0)
  uploaded_by       Int?
  
  businessProcess   BusinessProcessRegister @relation(fields: [business_process_id], references: [id], onDelete: Cascade)
  uploadedBy        User? @relation("BusinessProcessFileVersionUploadedBy", fields: [uploaded_by], references: [id])
  
  @@index([business_process_id], map: "idx_business_process_id")
  @@index([process_version], map: "idx_process_version")
  @@index([uploaded_by], map: "idx_uploaded_by")
  @@map("business_process_file_versions")
}

/// Business Document File Versions - Stores historical file uploads for each version
model BusinessDocumentFileVersion {
  id                Int      @id @default(autoincrement())
  business_document_id Int
  document_version   String   @db.VarChar(20)
  file_url          String   @db.VarChar(500)
  file_name         String   @db.VarChar(255)
  file_size         BigInt?
  file_type         String?  @db.VarChar(100)
  uploaded_at       DateTime @default(now()) @db.Timestamp(0)
  uploaded_by       Int?
  
  businessDocument  BusinessDocumentRegister @relation(fields: [business_document_id], references: [id], onDelete: Cascade)
  uploadedBy        User? @relation("BusinessDocumentFileVersionUploadedBy", fields: [uploaded_by], references: [id])
  
  @@index([business_document_id], map: "idx_business_document_id")
  @@index([document_version], map: "idx_document_version")
  @@index([uploaded_by], map: "idx_uploaded_by")
  @@map("business_document_file_versions")
}

/// Business Quality Objective File Versions - Stores historical file uploads for each version
model BusinessQualityObjectiveFileVersion {
  id                Int      @id @default(autoincrement())
  business_quality_objective_id Int
  objective_version String   @db.VarChar(20)
  file_url          String   @db.VarChar(500)
  file_name         String   @db.VarChar(255)
  file_size         BigInt?
  file_type         String?  @db.VarChar(100)
  uploaded_at       DateTime @default(now()) @db.Timestamp(0)
  uploaded_by       Int?
  
  businessQualityObjective BusinessQualityObjective @relation(fields: [business_quality_objective_id], references: [id], onDelete: Cascade)
  uploadedBy        User? @relation("BusinessQualityObjectiveFileVersionUploadedBy", fields: [uploaded_by], references: [id])
  
  @@index([business_quality_objective_id], map: "idx_business_quality_objective_id")
  @@index([objective_version], map: "idx_objective_version")
  @@index([uploaded_by], map: "idx_uploaded_by")
  @@map("business_quality_objective_file_versions")
}

/// Performance Monitoring Control File Versions - Stores historical file uploads for each version
model PerformanceMonitoringControlFileVersion {
  id                Int      @id @default(autoincrement())
  performance_monitoring_control_id Int
  control_version   String   @db.VarChar(20)
  file_url          String   @db.VarChar(500)
  file_name         String   @db.VarChar(255)
  file_size         BigInt?
  file_type         String?  @db.VarChar(100)
  uploaded_at       DateTime @default(now()) @db.Timestamp(0)
  uploaded_by       Int?
  
  performanceMonitoringControl PerformanceMonitoringControl @relation(fields: [performance_monitoring_control_id], references: [id], onDelete: Cascade)
  uploadedBy        User? @relation("PerformanceMonitoringControlFileVersionUploadedBy", fields: [uploaded_by], references: [id])
  
  @@index([performance_monitoring_control_id], map: "idx_performance_monitoring_control_id")
  @@index([control_version], map: "idx_control_version")
  @@index([uploaded_by], map: "idx_uploaded_by")
  @@map("performance_monitoring_control_file_versions")
}

/// Non Conformity File Versions - Stores historical file uploads for each version
model NonConformityFileVersion {
  id                Int      @id @default(autoincrement())
  non_conformity_id Int
  nc_version        String   @db.VarChar(20)
  file_url          String   @db.VarChar(500)
  file_name         String   @db.VarChar(255)
  file_size         BigInt?
  file_type         String?  @db.VarChar(100)
  uploaded_at       DateTime @default(now()) @db.Timestamp(0)
  uploaded_by       Int?
  
  nonConformity     NonConformity @relation(fields: [non_conformity_id], references: [id], onDelete: Cascade)
  uploadedBy        User? @relation("NonConformityFileVersionUploadedBy", fields: [uploaded_by], references: [id])
  
  @@index([non_conformity_id], map: "idx_non_conformity_id")
  @@index([nc_version], map: "idx_nc_version")
  @@index([uploaded_by], map: "idx_uploaded_by")
  @@map("non_conformity_file_versions")
}

/// Record Keeping System File Versions - Stores historical file uploads for each version
model RecordKeepingSystemFileVersion {
  id                Int      @id @default(autoincrement())
  record_keeping_system_id Int
  rks_version       String   @db.VarChar(20)
  file_url          String   @db.VarChar(500)
  file_name         String   @db.VarChar(255)
  file_size         BigInt?
  file_type         String?  @db.VarChar(100)
  uploaded_at       DateTime @default(now()) @db.Timestamp(0)
  uploaded_by       Int?
  
  recordKeepingSystem RecordKeepingSystem @relation(fields: [record_keeping_system_id], references: [id], onDelete: Cascade)
  uploadedBy        User? @relation("RecordKeepingSystemFileVersionUploadedBy", fields: [uploaded_by], references: [id])
  
  @@index([record_keeping_system_id], map: "idx_record_keeping_system_id")
  @@index([rks_version], map: "idx_rks_version")
  @@index([uploaded_by], map: "idx_uploaded_by")
  @@map("record_keeping_system_file_versions")
}

/// Business Improvement File Versions - Stores historical file uploads for each version
model BusinessImprovementFileVersion {
  id                Int      @id @default(autoincrement())
  business_improvement_id Int
  improvement_version String   @db.VarChar(20)
  file_url          String   @db.VarChar(500)
  file_name         String   @db.VarChar(255)
  file_size         BigInt?
  file_type         String?  @db.VarChar(100)
  uploaded_at       DateTime @default(now()) @db.Timestamp(0)
  uploaded_by       Int?
  
  businessImprovement BusinessImprovement @relation(fields: [business_improvement_id], references: [id], onDelete: Cascade)
  uploadedBy        User? @relation("BusinessImprovementFileVersionUploadedBy", fields: [uploaded_by], references: [id])
  
  @@index([business_improvement_id], map: "idx_business_improvement_id")
  @@index([improvement_version], map: "idx_improvement_version")
  @@index([uploaded_by], map: "idx_uploaded_by")
  @@map("business_improvement_file_versions")
}

/// Third Party Evaluation File Versions - Stores historical file uploads for each version
model ThirdPartyEvaluationFileVersion {
  id                Int      @id @default(autoincrement())
  third_party_evaluation_id Int
  evaluation_version String   @db.VarChar(20)
  file_url          String   @db.VarChar(500)
  file_name         String   @db.VarChar(255)
  file_size         BigInt?
  file_type         String?  @db.VarChar(100)
  uploaded_at       DateTime @default(now()) @db.Timestamp(0)
  uploaded_by       Int?
  
  thirdPartyEvaluation ThirdPartyEvaluation @relation(fields: [third_party_evaluation_id], references: [id], onDelete: Cascade)
  uploadedBy        User? @relation("ThirdPartyEvaluationFileVersionUploadedBy", fields: [uploaded_by], references: [id])
  
  @@index([third_party_evaluation_id], map: "idx_third_party_evaluation_id")
  @@index([evaluation_version], map: "idx_evaluation_version")
  @@index([uploaded_by], map: "idx_uploaded_by")
  @@map("third_party_evaluation_file_versions")
}

/// Customer Feedback System File Versions - Stores historical file uploads for each version
model CustomerFeedbackSystemFileVersion {
  id                Int      @id @default(autoincrement())
  customer_feedback_system_id Int
  feedback_version  String   @db.VarChar(20)
  file_url          String   @db.VarChar(500)
  file_name         String   @db.VarChar(255)
  file_size         BigInt?
  file_type         String?  @db.VarChar(100)
  uploaded_at       DateTime @default(now()) @db.Timestamp(0)
  uploaded_by       Int?
  
  customerFeedbackSystem CustomerFeedbackSystem @relation(fields: [customer_feedback_system_id], references: [id], onDelete: Cascade)
  uploadedBy        User? @relation("CustomerFeedbackSystemFileVersionUploadedBy", fields: [uploaded_by], references: [id])
  
  @@index([customer_feedback_system_id], map: "idx_customer_feedback_system_id")
  @@index([feedback_version], map: "idx_feedback_version")
  @@index([uploaded_by], map: "idx_uploaded_by")
  @@map("customer_feedback_system_file_versions")
}

/// Training Session File Versions - Stores historical file uploads for each version
model TrainingSessionFileVersion {
  id                Int      @id @default(autoincrement())
  training_session_id Int
  session_version   String   @db.VarChar(20)
  file_url          String   @db.VarChar(500)
  file_name         String   @db.VarChar(255)
  file_size         BigInt?
  file_type         String?  @db.VarChar(100)
  uploaded_at       DateTime @default(now()) @db.Timestamp(0)
  uploaded_by       Int?
  
  trainingSession   TrainingSession @relation(fields: [training_session_id], references: [id], onDelete: Cascade)
  uploadedBy        User? @relation("TrainingSessionFileVersionUploadedBy", fields: [uploaded_by], references: [id])
  
  @@index([training_session_id], map: "idx_training_session_id")
  @@index([session_version], map: "idx_session_version")
  @@index([uploaded_by], map: "idx_uploaded_by")
  @@map("training_session_file_versions")
}

/// RACM Matrix File Versions - Stores historical file uploads for each version
model RacmMatrixFileVersion {
  id                Int      @id @default(autoincrement())
  racm_matrix_id    Int
  matrix_version    String   @db.VarChar(20)
  file_url          String   @db.VarChar(500)
  file_name         String   @db.VarChar(255)
  file_size         BigInt?
  file_type         String?  @db.VarChar(100)
  uploaded_at       DateTime @default(now()) @db.Timestamp(0)
  uploaded_by       Int?
  
  racmMatrix        RacmMatrix @relation(fields: [racm_matrix_id], references: [id], onDelete: Cascade)
  uploadedBy        User? @relation("RacmMatrixFileVersionUploadedBy", fields: [uploaded_by], references: [id])
  
  @@index([racm_matrix_id], map: "idx_racm_matrix_id")
  @@index([matrix_version], map: "idx_matrix_version")
  @@index([uploaded_by], map: "idx_uploaded_by")
  @@map("racm_matrix_file_versions")
}

/// QMS Assessment File Versions - Stores historical file uploads for each version
model QMSAssessmentFileVersion {
  id                Int      @id @default(autoincrement())
  qms_assessment_id Int
  assessment_version String   @db.VarChar(20)
  file_url          String   @db.VarChar(500)
  file_name         String   @db.VarChar(255)
  file_size         BigInt?
  file_type         String?  @db.VarChar(100)
  uploaded_at       DateTime @default(now()) @db.Timestamp(0)
  uploaded_by       Int?
  
  qmsAssessment     QMSAssessment @relation(fields: [qms_assessment_id], references: [id], onDelete: Cascade)
  uploadedBy        User? @relation("QMSAssessmentFileVersionUploadedBy", fields: [uploaded_by], references: [id])
  
  @@index([qms_assessment_id], map: "idx_qms_assessment_id")
  @@index([assessment_version], map: "idx_assessment_version")
  @@index([uploaded_by], map: "idx_uploaded_by")
  @@map("qms_assessment_file_versions")
}

/// Links between Business Documents (e.g., policy related to SOP)
model BusinessDocumentLink {
  id                   Int      @id @default(autoincrement())
  primary_document_id  Int
  related_document_id  Int
  created_at           DateTime @default(now()) @db.Timestamp(0)
  updated_at           DateTime @default(now()) @updatedAt @db.Timestamp(0)
  created_by           Int?

  primaryDocument      BusinessDocumentRegister @relation("PrimaryDocument", fields: [primary_document_id], references: [id], onDelete: Cascade)
  relatedDocument      BusinessDocumentRegister @relation("RelatedDocument", fields: [related_document_id], references: [id], onDelete: Cascade)
  createdBy            User? @relation("BusinessDocumentLinkCreatedBy", fields: [created_by], references: [id])

  @@unique([primary_document_id, related_document_id], map: "unique_document_link_pair")
  @@index([primary_document_id], map: "idx_primary_document_id")
  @@index([related_document_id], map: "idx_related_document_id")
  @@index([created_by], map: "idx_document_link_created_by")
  @@index([created_at], map: "idx_document_link_created_at")
  @@map("business_document_links")
}

model PerformanceMonitoringControl {
  id                  Int            @id @default(autoincrement())
  business_area       String?        @db.VarChar(50)
  sub_business_area   String?        @db.VarChar(100)
  Name_reports        String?        @db.VarChar(100)
  doc_type            String?        @db.VarChar(50)
  priority            String?        @db.VarChar(20)
  doc_status          String?        @db.VarChar(100)
  progress            String?        @db.VarChar(100)
  status_percentage   Decimal?       @db.Decimal(5, 0)
  version             String?        @db.VarChar(20)
  target_date         DateTime?      @db.Date
  proof               String?        @db.VarChar(20)
  frequency           String?        @db.VarChar(50)
  responsible_persons String?        @db.VarChar(50)
  remarks             String?        @db.Text
  file_url            String?        @db.VarChar(500)
  file_name           String?        @db.VarChar(255)
  file_size           BigInt?
  file_type           String?        @db.VarChar(100)
  uploaded_at         DateTime?      @default(now()) @db.Timestamp(0)
  deleted_at          DateTime?      @db.Timestamp(0)
  deleted_by          Int?
  businessareas       BusinessAreas? @relation(fields: [business_area], references: [business_area], onDelete: NoAction, onUpdate: NoAction, map: "fk_pmc_business_area")
  deletedBy           User?          @relation("PerformanceMonitoringDeletedBy", fields: [deleted_by], references: [id])
  fileVersions        PerformanceMonitoringControlFileVersion[]

  @@index([business_area], map: "fk_pmc_business_area")
  @@index([deleted_at], map: "idx_deleted_at")
  @@index([deleted_by], map: "idx_deleted_by")
  @@map("performancemonitoringcontrol")
}

model RacmMatrixHistory {
  id                        Int            @id @default(autoincrement())
  racm_matrix_id            Int
  inherent_risk_score       Int?
  residual_risk_overall_score Int?
  change_date               DateTime       @default(now()) @db.Timestamp(0)
  change_type               String         @db.VarChar(20) // 'created', 'updated'
  created_at                DateTime       @default(now()) @db.Timestamp(0)
  
  racmMatrix                RacmMatrix     @relation(fields: [racm_matrix_id], references: [id], onDelete: Cascade)

  @@index([racm_matrix_id], map: "fk_rmh_racm_matrix_id")
  @@index([change_date], map: "idx_change_date")
  @@map("racm_matrix_history")
}

model RacmMatrix {
  id                        Int            @id @default(autoincrement())
  process_name              String         @db.VarChar(255)
  activity_description      String?        @db.Text
  issue_description         String         @db.Text
  issue_type                String?        @db.VarChar(100)
  inherent_risk_likeliness  Int?
  inherent_risk_impact      Int?
  inherent_risk_score       Int?
  control_description       String?        @db.Text
  control_type              String?        @db.VarChar(20)
  control_owner             String?        @db.VarChar(255)
  control_effectiveness     String?        @db.VarChar(20)
  residual_risk_likeliness  Int?
  status                    String?        @db.VarChar(20)
  created_at                DateTime?      @default(now()) @db.Timestamp(0)
  updated_at                DateTime?      @default(now()) @updatedAt @db.Timestamp(0)
  business_area             String?        @db.VarChar(50)
  doc_status                String?        @db.VarChar(20)
  version                   String?        @db.VarChar(20)
  file_url                  String?        @db.VarChar(500)
  file_name                 String?        @db.VarChar(255)
  file_size                 BigInt?
  file_type                 String?        @db.VarChar(100)
  uploaded_at               DateTime?      @default(now()) @db.Timestamp(0)
  deleted_at                DateTime?      @db.Timestamp(0)
  deleted_by                Int?
  control_progress          Decimal?       @db.Decimal(5, 0)
  control_target_date       DateTime?      @db.Date
  residual_risk_impact      Int?
  residual_risk_overall_score Int?
  businessareas             BusinessAreas? @relation(fields: [business_area], references: [business_area], onDelete: NoAction, onUpdate: NoAction, map: "fk_rm_business_area")
  deletedBy                 User?          @relation("RacmMatrixDeletedBy", fields: [deleted_by], references: [id])
  history                   RacmMatrixHistory[]
  fileVersions              RacmMatrixFileVersion[]

  @@index([business_area], map: "fk_rm_business_area")
  @@index([deleted_at], map: "idx_deleted_at")
  @@index([deleted_by], map: "idx_deleted_by")
  @@map("racm_matrix")
}

model User {
  id                  Int                   @id @default(autoincrement())
  email               String                @unique(map: "email") @db.VarChar(50)
  username            String                @unique(map: "username") @db.VarChar(20)
  password            String?               @db.VarChar(255) // Made optional for federated users
  business_area       String?               @db.VarChar(50)
  created_at          DateTime?             @default(now()) @db.Timestamp(0)
  // Legacy OAuth fields
  name                String?               @db.VarChar(191)
  emailVerified       DateTime?             @db.DateTime(3)
  image               String?               @db.VarChar(191)
  // Legacy OAuth relations
  accounts            Account[]
  sessions            Session[]
  // Existing relations
  user_business_areas user_business_areas[]
  businessareas       BusinessAreas?        @relation(fields: [business_area], references: [business_area], onDelete: NoAction, onUpdate: NoAction, map: "fk_use_business_area")
  deletedBusinessProcesses BusinessProcessRegister[] @relation("BusinessProcessDeletedBy")
  deletedBusinessDocuments BusinessDocumentRegister[] @relation("BusinessDocumentDeletedBy")
  deletedBusinessQualityObjectives BusinessQualityObjective[] @relation("BusinessQualityObjectiveDeletedBy")
  deletedPerformanceMonitoring PerformanceMonitoringControl[] @relation("PerformanceMonitoringDeletedBy")
  deletedRacmMatrix RacmMatrix[] @relation("RacmMatrixDeletedBy")
  deletedNonConformities NonConformity[] @relation("NonConformityDeletedBy")
  deletedRecordKeepingSystems RecordKeepingSystem[] @relation("RecordKeepingDeletedBy")
  deletedBusinessImprovements BusinessImprovement[] @relation("BusinessImprovementDeletedBy")
  deletedTrainingSessions TrainingSession[] @relation("TrainingSessionDeletedBy")
  deletedThirdPartyEvaluations ThirdPartyEvaluation[] @relation("ThirdPartyEvaluationDeletedBy")
  deletedCustomerFeedbackSystems CustomerFeedbackSystem[] @relation("CustomerFeedbackSystemDeletedBy")
  deletedQMSAssessments QMSAssessment[] @relation("QMSAssessmentDeletedBy")
  createdBusinessQualityObjectiveProgress BusinessQualityObjectiveProgress[] @relation("BusinessQualityObjectiveProgressCreatedBy")
  createdBusinessProcessDocumentLinks BusinessProcessDocumentLink[] @relation("BusinessProcessDocumentLinkCreatedBy")
  createdBusinessDocumentLinks BusinessDocumentLink[] @relation("BusinessDocumentLinkCreatedBy")
  uploadedBusinessProcessFileVersions BusinessProcessFileVersion[] @relation("BusinessProcessFileVersionUploadedBy")
  uploadedBusinessDocumentFileVersions BusinessDocumentFileVersion[] @relation("BusinessDocumentFileVersionUploadedBy")
  uploadedBusinessQualityObjectiveFileVersions BusinessQualityObjectiveFileVersion[] @relation("BusinessQualityObjectiveFileVersionUploadedBy")
  uploadedPerformanceMonitoringControlFileVersions PerformanceMonitoringControlFileVersion[] @relation("PerformanceMonitoringControlFileVersionUploadedBy")
  uploadedNonConformityFileVersions NonConformityFileVersion[] @relation("NonConformityFileVersionUploadedBy")
  uploadedRecordKeepingSystemFileVersions RecordKeepingSystemFileVersion[] @relation("RecordKeepingSystemFileVersionUploadedBy")
  uploadedBusinessImprovementFileVersions BusinessImprovementFileVersion[] @relation("BusinessImprovementFileVersionUploadedBy")
  uploadedThirdPartyEvaluationFileVersions ThirdPartyEvaluationFileVersion[] @relation("ThirdPartyEvaluationFileVersionUploadedBy")
  uploadedCustomerFeedbackSystemFileVersions CustomerFeedbackSystemFileVersion[] @relation("CustomerFeedbackSystemFileVersionUploadedBy")
  uploadedTrainingSessionFileVersions TrainingSessionFileVersion[] @relation("TrainingSessionFileVersionUploadedBy")
  uploadedRacmMatrixFileVersions RacmMatrixFileVersion[] @relation("RacmMatrixFileVersionUploadedBy")
  uploadedQMSAssessmentFileVersions QMSAssessmentFileVersion[] @relation("QMSAssessmentFileVersionUploadedBy")

  @@index([business_area], map: "fk_use_business_area")
  @@map("users")
}

model BusinessAreas {
  business_area                String                         @id @db.VarChar(50)
  businessdocumentregister     BusinessDocumentRegister[]
  businessprocessregister      BusinessProcessRegister[]
  businessqualityobjectives    BusinessQualityObjective[]
  performancemonitoringcontrol PerformanceMonitoringControl[]
  racm_matrix                  RacmMatrix[]
  trainingsessions             TrainingSession[]
  user_business_areas          user_business_areas[]
  users                        User[]
  nonConformities              NonConformity[]
  recordKeepingSystems         RecordKeepingSystem[]
  businessImprovements         BusinessImprovement[]

  @@map("businessareas")
}

model BusinessProcessVersions {
  id                Int      @id @default(autoincrement())
  businessProcessId String
  versionNumber     String
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@map("businessprocessversions")
}

/// QMS Internal Self-Assessment models
model QMSAssessment {
  id                       Int                 @id @default(autoincrement())
  approvalDate             DateTime?           @db.Date
  approvedByGoverningBody  String?             @db.VarChar(100)
  assessmentConductedBy    String?             @db.VarChar(100)
  assessment_date          DateTime?           @db.Date
  assessmentDateRangeEnd   String?             @db.VarChar(20)
  assessmentDateRangeStart String?             @db.VarChar(20)
  assessor_name            String?             @db.VarChar(100)
  assessorDate             DateTime?           @db.Date
  business_area            String?             @db.VarChar(100)
  created_at               DateTime?           @default(now()) @db.Timestamp(0)
  section1Data             String?             @db.Text
  section2Data             String?             @db.Text
  section3Data             String?             @db.Text
  section4Data             String?             @db.Text
  status                   String              @default("draft") @db.VarChar(20)
  version                  String?             @db.VarChar(20)
  updatedAt                DateTime            @default(now()) @db.Timestamp(0)
  file_url                 String?             @db.VarChar(500)
  file_name                String?             @db.VarChar(255)
  file_size                BigInt?
  file_type                String?             @db.VarChar(100)
  uploaded_at              DateTime?           @default(now()) @db.Timestamp(0)
  deleted_at               DateTime?           @db.Timestamp(0)
  deleted_by               Int?
  approval                 QMSApproval[]
  items                    QMSAssessmentItem[]
  deletedBy                User?               @relation("QMSAssessmentDeletedBy", fields: [deleted_by], references: [id])
  fileVersions             QMSAssessmentFileVersion[]

  @@index([deleted_at], map: "idx_deleted_at")
  @@index([deleted_by], map: "idx_deleted_by")
  @@map("qms_assessments")
}

model QMSAssessmentItem {
  id               Int            @id @default(autoincrement())
  assessment_id    Int?
  section          String?        @db.VarChar(50)
  clause_reference String?        @db.VarChar(20)
  item_number      String?        @db.VarChar(10)
  item_description String?        @db.Text
  status           QMSStatus
  comment          String?        @db.Text
  assessment       QMSAssessment? @relation(fields: [assessment_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "qms_assessment_items_ibfk_1")

  @@index([assessment_id], map: "assessment_id")
  @@map("qms_assessment_items")
}

model QMSApproval {
  id             Int            @id @default(autoincrement())
  assessment_id  Int?
  conducted_by   String?        @db.VarChar(100)
  conducted_date DateTime?      @db.Date
  approved_by    String?        @db.VarChar(100)
  approved_date  DateTime?      @db.Date
  assessment     QMSAssessment? @relation(fields: [assessment_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "qms_approvals_ibfk_1")

  @@index([assessment_id], map: "assessment_id")
  @@map("qms_approvals")
}

model QMSSection {
  id               Int     @id @default(autoincrement())
  section_number   String? @db.VarChar(10)
  title            String? @db.VarChar(255)
  clause_reference String? @db.VarChar(50)

  @@map("qms_sections")
}

model ThirdPartyEvaluation {
  id                        Int      @id @default(autoincrement())
  supplier_name             String   @db.VarChar(100)
  business_area             String   @db.VarChar(100)
  evaluation_system_in_place String  @db.VarChar(20)
  document_reference        String?  @db.Text
  last_evaluation_date      DateTime? @db.Date
  status_percentage         Decimal? @db.Decimal(5, 0)
  doc_status                String   @db.VarChar(20)
  progress                  String   @db.VarChar(20)
  version                   String?  @db.VarChar(20)
  notes                     String?  @db.Text
  file_url                  String?  @db.VarChar(500)
  file_name                 String?  @db.VarChar(255)
  file_size                 BigInt?
  file_type                 String?  @db.VarChar(100)
  uploaded_at               DateTime? @default(now()) @db.Timestamp(0)
  created_at                DateTime @default(now()) @db.Timestamp(0)
  updated_at                DateTime @default(now()) @updatedAt @db.Timestamp(0)
  deleted_at                DateTime? @db.Timestamp(0)
  deleted_by                Int?
  deletedBy                 User?    @relation("ThirdPartyEvaluationDeletedBy", fields: [deleted_by], references: [id])
  fileVersions              ThirdPartyEvaluationFileVersion[]

  @@index([deleted_at], map: "idx_deleted_at")
  @@index([deleted_by], map: "idx_deleted_by")
  @@map("third_party_evaluations")
}

model CustomerFeedbackSystem {
  id                  Int      @id @default(autoincrement())
  business_area       String   @db.VarChar(100)
  has_feedback_system String   @db.VarChar(20)
  document_reference  String?  @db.Text
  last_review_date    DateTime? @db.Date
  status_percentage   Decimal? @db.Decimal(5, 0)
  doc_status          String   @db.VarChar(20)
  progress            String   @db.VarChar(20)
  version             String?  @db.VarChar(20)
  notes               String?  @db.Text
  file_url            String?  @db.VarChar(500)
  file_name           String?  @db.VarChar(255)
  file_size           BigInt?
  file_type           String?  @db.VarChar(100)
  uploaded_at         DateTime? @default(now()) @db.Timestamp(0)
  created_at          DateTime @default(now()) @db.Timestamp(0)
  updated_at          DateTime @default(now()) @updatedAt @db.Timestamp(0)
  deleted_at          DateTime? @db.Timestamp(0)
  deleted_by          Int?
  deletedBy           User?    @relation("CustomerFeedbackSystemDeletedBy", fields: [deleted_by], references: [id])
  fileVersions        CustomerFeedbackSystemFileVersion[]

  @@index([deleted_at], map: "idx_deleted_at")
  @@index([deleted_by], map: "idx_deleted_by")
  @@map("customer_feedback_systems")
}

/// Non-Conformity & Corrective Action Management
model NonConformity {
  id                  Int            @id @default(autoincrement())
  business_area       String?        @db.VarChar(50)
  sub_business_area   String?        @db.VarChar(100)
  nc_number           String?        @db.VarChar(50)
  nc_type             String?        @db.VarChar(50)
  description         String?        @db.Text
  root_cause          String?        @db.Text
  corrective_action   String?        @db.Text
  responsible_person  String?        @db.VarChar(100)
  target_date         DateTime?      @db.Date
  completion_date     DateTime?      @db.Date
  status              String?        @db.VarChar(20)
  priority            String?        @db.VarChar(20)
  impact_level        String?        @db.VarChar(20)
  version             String?        @db.VarChar(20)
  verification_method  String?        @db.Text
  effectiveness_review String?        @db.Text
  lessons_learned     String?        @db.Text
  related_documents   String?        @db.Text
  file_url            String?        @db.VarChar(500)
  file_name           String?        @db.VarChar(255)
  file_size           BigInt?
  file_type           String?        @db.VarChar(100)
  uploaded_at         DateTime?      @default(now()) @db.Timestamp(0)
  created_at          DateTime?      @default(now()) @db.Timestamp(0)
  updated_at          DateTime?      @default(now()) @updatedAt @db.Timestamp(0)
  deleted_at          DateTime?      @db.Timestamp(0)
  deleted_by          Int?
  businessareas       BusinessAreas? @relation(fields: [business_area], references: [business_area], onDelete: NoAction, onUpdate: NoAction, map: "fk_nc_business_area")
  deletedBy           User?          @relation("NonConformityDeletedBy", fields: [deleted_by], references: [id])
  fileVersions        NonConformityFileVersion[]

  @@index([business_area], map: "fk_nc_business_area")
  @@index([deleted_at], map: "idx_deleted_at")
  @@index([deleted_by], map: "idx_deleted_by")
  @@map("non_conformities")
}

/// Record Keeping Management
model RecordKeepingSystem {
  id                  Int            @id @default(autoincrement())
  business_area       String?        @db.VarChar(50)
  sub_business_area   String?        @db.VarChar(100)
  record_type         String?        @db.VarChar(100)
  system_name         String?        @db.VarChar(100)
  system_description  String?        @db.Text
  retention_period    String?        @db.VarChar(100)
  storage_location    String?        @db.VarChar(255)
  access_controls     String?        @db.Text
  backup_procedures   String?        @db.Text
  disposal_procedures String?        @db.Text
  compliance_status   String?        @db.VarChar(20)
  last_audit_date     DateTime?      @db.Date
  next_audit_date     DateTime?      @db.Date
  audit_findings      String?        @db.Text
  corrective_actions  String?        @db.Text
  responsible_person  String?        @db.VarChar(100)
  status_percentage   Decimal?       @db.Decimal(5, 0)
  doc_status          String?        @db.VarChar(20)
  progress            String?        @db.VarChar(20)
  version             String?        @db.VarChar(20)
  notes               String?        @db.Text
  file_url            String?        @db.VarChar(500)
  file_name           String?        @db.VarChar(255)
  file_size           BigInt?
  file_type           String?        @db.VarChar(100)
  uploaded_at         DateTime?      @default(now()) @db.Timestamp(0)
  created_at          DateTime?      @default(now()) @db.Timestamp(0)
  updated_at          DateTime?      @default(now()) @updatedAt @db.Timestamp(0)
  deleted_at          DateTime?      @db.Timestamp(0)
  deleted_by          Int?
  businessareas       BusinessAreas? @relation(fields: [business_area], references: [business_area], onDelete: NoAction, onUpdate: NoAction, map: "fk_rks_business_area")
  deletedBy           User?          @relation("RecordKeepingDeletedBy", fields: [deleted_by], references: [id])
  fileVersions        RecordKeepingSystemFileVersion[]

  @@index([business_area], map: "fk_rks_business_area")
  @@index([deleted_at], map: "idx_deleted_at")
  @@index([deleted_by], map: "idx_deleted_by")
  @@map("record_keeping_systems")
}

/// Business Improvements Management
model BusinessImprovement {
  id                      Int            @id @default(autoincrement())
  business_area           String?        @db.VarChar(50)
  sub_business_area       String?        @db.VarChar(100)
  improvement_title       String?        @db.VarChar(255)
  improvement_type        String?        @db.VarChar(50)
  description             String?        @db.Text
  business_case           String?        @db.Text
  expected_benefits       String?        @db.Text
  implementation_plan     String?        @db.Text
  success_criteria        String?        @db.Text
  responsible_person      String?        @db.VarChar(100)
  start_date              DateTime?      @db.Date
  target_completion_date  DateTime?      @db.Date
  actual_completion_date  DateTime?      @db.Date
  status                  String?        @db.VarChar(20)
  priority                String?        @db.VarChar(20)
  budget_allocated        Decimal?       @db.Decimal(10, 2)
  actual_cost             Decimal?       @db.Decimal(10, 2)
  roi_calculation         String?        @db.Text
  lessons_learned         String?        @db.Text
  next_steps              String?        @db.Text
  related_processes       String?        @db.Text
  status_percentage       Decimal?       @db.Decimal(5, 0)
  doc_status              String?        @db.VarChar(20)
  progress                String?        @db.VarChar(20)
  version                 String?        @db.VarChar(20)
  notes                   String?        @db.Text
  file_url                String?        @db.VarChar(500)
  file_name               String?        @db.VarChar(255)
  file_size               BigInt?
  file_type               String?        @db.VarChar(100)
  uploaded_at             DateTime?      @default(now()) @db.Timestamp(0)
  created_at              DateTime?      @default(now()) @db.Timestamp(0)
  updated_at              DateTime?      @default(now()) @updatedAt @db.Timestamp(0)
  deleted_at              DateTime?      @db.Timestamp(0)
  deleted_by              Int?
  businessareas           BusinessAreas? @relation(fields: [business_area], references: [business_area], onDelete: NoAction, onUpdate: NoAction, map: "fk_bi_business_area")
  deletedBy               User?          @relation("BusinessImprovementDeletedBy", fields: [deleted_by], references: [id])
  fileVersions            BusinessImprovementFileVersion[]

  @@index([business_area], map: "fk_bi_business_area")
  @@index([deleted_at], map: "idx_deleted_at")
  @@index([deleted_by], map: "idx_deleted_by")
  @@map("business_improvements")
}

model QMSStatusOption {
  code    QMSStatus @id
  meaning String?   @db.VarChar(100)

  @@map("qms_status_options")
}

model user_business_areas {
  id            Int           @id @default(autoincrement())
  user_id       Int
  business_area String        @db.VarChar(50)
  created_at    DateTime?     @default(now()) @db.Timestamp(0)
  users         User          @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "user_business_areas_ibfk_1")
  businessareas BusinessAreas @relation(fields: [business_area], references: [business_area], onDelete: Cascade, onUpdate: NoAction, map: "user_business_areas_ibfk_2")

  @@unique([user_id, business_area], map: "unique_user_business")
  @@index([business_area], map: "business_area")
}

// Legacy OAuth support models
model Account {
  id                String  @id @default(cuid())
  userId            Int
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("account")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       Int
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("session")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

enum QMSStatus {
  C
  NC
  OFI
  NA
}
